/*
 */

#include<avr/io.h>

#include "defines.h"
#include "tc.h"


/* ==================================================================*
 * 						FUNCTIONS Timer Counter 16MHz
 * ==================================================================*/

void TC_Wait_1clk(void)
{
	asm volatile("nop");
}



/* ==================================================================*
 * 						TC0 - 8Bit-MainWaitTimer
 * ==================================================================*/

/* ------------------------------------------------------------------*
 * 						TC0 - 1ms Init
 * ------------------------------------------------------------------*/

void TC0_16MHzWait_1ms_Init(void)
{
	TCNT0 = 0x00;
	TCCR0A = (1<<CS00) | (1<<CS01);				//start clk/64
}


/* ------------------------------------------------------------------*
 * 						TC0 - Query TC0 Overflow -> 1ms
 * ------------------------------------------------------------------*/

unsigned char TC0_16MHzWait_1ms_Query(void)
{
	if(TIFR0 & (1<<TOV0)){		//wait 1ms
    TIFR0  |= (1<<TOV0);		//Reset Flag
		return 1;}
	return 0;
}


/* ------------------------------------------------------------------*
 * 						TC0 - Stop
 * ------------------------------------------------------------------*/

void TC0_16MHz_Stop(void)
{
	TCCR0A &= ~((1<<CS00) | (1<<CS01));		//stop clk/64
}


/* ------------------------------------------------------------------*
 * 						TC0 - Timer App While
 * ------------------------------------------------------------------*/

void TC0_16MHzWait_msWhile(int mSec)
{
	int i=0;
	TC0_16MHzWait_1ms_Init();									//InitTimer
	for(i=0; i<mSec; i++)	while(!TC0_16MHzWait_1ms_Query());	//WaitLoop
}


/* ------------------------------------------------------------------*
 * 						TC0 - Timer App IF
 * ------------------------------------------------------------------*/

unsigned char TC0_16MHzWait_msQuery(t_FuncCmd cmd, int mSec)
{
	static int i = 0;
	static int ms = 0;
	if(cmd == _init)
	{
		i = 0;
		ms = mSec;
		TC0_16MHzWait_1ms_Init();				//InitTimer
	}

	else if(cmd == _exe)
	{
		if(TC0_16MHzWait_1ms_Query()){		//Query
			i++;
			if(i > ms){						          //match
				i = 0;
				return 1;}}
	}
	return 0;
}



/* ==================================================================*
 * 						TC2 - 8Bit-SecondWaitTimer
 * ==================================================================*/

/* ------------------------------------------------------------------*
 * 						TC2 - 1ms Init
 * ------------------------------------------------------------------*/

void TC2_16MHzWait_1ms_Init(void)
{
	TCNT2 = 0x00;
	TCCR2A = (1<<CS22);				//start clk/64
}


/* ------------------------------------------------------------------*
 * 						TC2 - Query TC2 Overflow -> 1ms
 * ------------------------------------------------------------------*/

unsigned char TC2_16MHzWait_1ms_Query(void)
{
	if(TIFR2 & (1<<TOV2))						//wait 1ms
	{
		TIFR2  |= (1<<TOV2);					//Reset Flag
		return 1;
	}
	return 0;
}


/* ------------------------------------------------------------------*
 * 						TC2 - Stop
 * ------------------------------------------------------------------*/

void TC2_16MHz_Stop(void)
{
	TCCR2A &= ~(1<<CS22);		//stop clk/64
}


/* ------------------------------------------------------------------*
 * 						TC2 - Timer App While
 * ------------------------------------------------------------------*/

void TC2_16MHzWait_msWhile(int mSec)
{
	int i = 0;
	TC2_16MHzWait_1ms_Init();									//InitTimer
	for(i = 0; i < mSec; i++)	while(!TC2_16MHzWait_1ms_Query());	//Wait
}


/* ------------------------------------------------------------------*
 * 						TC2 - Timer App IF
 * ------------------------------------------------------------------*/

unsigned char TC2_16MHzWait_msQuery(t_FuncCmd cmd, int mSec)
{
	static int i = 0;
	static int ms = 0;
	if(cmd == _init)
	{
		i = 0;
		ms = mSec;
		TC2_16MHzWait_1ms_Init();				//InitTimer
	}

	else if(cmd == _exe)
	{
		if(TC2_16MHzWait_1ms_Query())			//Query
		{
			i++;
			if(i > ms)							//match
			{
				i = 0;
				return 1;
			}
		}
	}
	return 0;
}



/* ==================================================================*
 * 						TC3 - reserved
 * ==================================================================*/


/* ==================================================================*
 * 						TC1 - Reserved
 * ==================================================================*/






/*********************************************************************\
 * End of file
\**********************************************************************/
